# plant-helper-service

æ¤ç‰©ç§æ¤åŠ©æ‰‹å°ç¨‹åºåŽç«¯æœåŠ¡ï¼Œå•æœºæœåŠ¡ï¼Œä¸éœ€è¦åˆ†å¸ƒå¼ï¼ŒåŸºäºŽå¾®ä¿¡äº‘æ‰˜ç®¡ Spring Boot æ¡†æž¶å®žçŽ°ã€‚

## é¡¹ç›®ä¿¡æ¯

| é¡¹ç›®ä¿¡æ¯ | è¯´æ˜Ž |
|---------|------|
| é¡¹ç›®åç§° | plant-helper-service |
| æ¡†æž¶ | Spring Boot 2.7.18 + Java 8 |
| æ•°æ®åº“ | MySQL 8.0+ (Connector 8.0.33) + MyBatis Plus 3.5.3 |
| åˆ†é¡µæ’ä»¶ | PageHelper 1.4.3 + MyBatis Plusåˆ†é¡µæ’ä»¶ |
| APIæ–‡æ¡£ | SpringDoc OpenAPI 1.7.0 (Swagger UI) |
| éƒ¨ç½²å¹³å° | å¾®ä¿¡äº‘æ‰˜ç®¡ |
| æž„å»ºå·¥å…· | Maven |
| å®¹å™¨åŒ– | Docker |

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘
1. **çŽ¯å¢ƒå‡†å¤‡**ï¼šJava 8, Maven 3.6+, MySQL 8.0+
2. **æ•°æ®åº“åˆå§‹åŒ–**ï¼šæ‰§è¡Œ `docs/db.sql` åˆ›å»ºæ•°æ®åº“å’Œè¡¨
3. **é…ç½®æ–‡ä»¶**ï¼šå¤åˆ¶ `application-dev.yml` å¹¶æ ¹æ®æœ¬åœ°çŽ¯å¢ƒä¿®æ”¹æ•°æ®åº“è¿žæŽ¥
4. **å¯åŠ¨åº”ç”¨**ï¼š
   ```bash
   mvn clean spring-boot:run
   ```
5. **è®¿é—®æŽ¥å£**ï¼šåº”ç”¨è¿è¡Œåœ¨ `http://localhost:18080`
6. **APIæ–‡æ¡£**ï¼šè®¿é—® `http://localhost:18080/swagger-ui.html` æŸ¥çœ‹å’Œæµ‹è¯•æŽ¥å£ï¼ˆå¼€å‘çŽ¯å¢ƒï¼‰

### Dockerè¿è¡Œ
```bash
# æž„å»ºé•œåƒ
docker build -t plant-helper-service .

# è¿è¡Œå®¹å™¨
docker run -p 18080:18080 \
  -e SPRING_PROFILES_ACTIVE=dev \
  -e WX_APPID=your_appid \
  -e WX_SECRET=your_secret \
  plant-helper-service
```

### è¿è¡Œæµ‹è¯•
**å½“å‰æµ‹è¯•çŠ¶æ€**ï¼šé¡¹ç›®åŒ…å«æµ‹è¯•èµ„æºé…ç½®ï¼Œä½†Javaå•å…ƒæµ‹è¯•ç±»å°šæœªåˆ›å»ºï¼ˆå·²è¯†åˆ«é—®é¢˜ï¼‰

```bash
# è¿è¡Œæµ‹è¯•ï¼ˆå½“å‰æ— Javaæµ‹è¯•ç±»ï¼Œå‘½ä»¤ä¼šæˆåŠŸä½†æ— æµ‹è¯•æ‰§è¡Œï¼‰
mvn test

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn surefire-report:report
```

**æµ‹è¯•èµ„æº**ï¼š
- `src/test/resources/application-test.yml` - æµ‹è¯•çŽ¯å¢ƒé…ç½®
- `src/test/resources/test-data.sql` - æµ‹è¯•æ•°æ®è„šæœ¬

**å¾…å®Œæˆ**ï¼šéœ€è¦åˆ›å»ºæŽ§åˆ¶å™¨å’ŒæœåŠ¡å±‚çš„å•å…ƒæµ‹è¯•ç±»

## åŠŸèƒ½æ¨¡å—

1. **ç”¨æˆ·è®¤è¯ (Auth)** - å¾®ä¿¡å°ç¨‹åºç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†ã€Tokenè®¤è¯
2. **æ¤ç‰©ç®¡ç† (Plant)** - æ¤ç‰©çš„CRUDæ“ä½œã€åˆ†é¡µæŸ¥è¯¢
3. **ç§æ¤è®°å½• (Record)** - è®°å½•æ¤ç‰©ç”Ÿé•¿è¿‡ç¨‹ï¼ˆæµ‡æ°´ã€æ–½è‚¥ã€ç”Ÿé•¿ã€æ‹ç…§ï¼‰
4. **æé†’ç®¡ç† (Reminder)** - æ¤ç‰©å…»æŠ¤æé†’è®¾ç½®ä¸Žè°ƒåº¦
5. **ç»Ÿä¸€è®¤è¯æ‹¦æˆªå™¨ (AuthInterceptor)** - è‡ªåŠ¨éªŒè¯Tokenï¼Œç»Ÿä¸€è®¤è¯é€»è¾‘
6. **APIæ–‡æ¡£ç³»ç»Ÿ (OpenAPI)** - è‡ªåŠ¨ç”ŸæˆSwaggeræ–‡æ¡£ï¼Œæ”¯æŒåœ¨çº¿æµ‹è¯•

## æŠ€æœ¯æ ˆ

- Spring Boot 2.7.18
- MyBatis Plus 3.5.3ï¼ˆå¢žå¼ºORMåŠŸèƒ½ï¼ŒåŒ…å«åˆ†é¡µæ’ä»¶ï¼‰
- MySQL 8.0+ï¼ˆè¿žæŽ¥å™¨ç‰ˆæœ¬ï¼š8.0.33ï¼‰
- Lombokï¼ˆç®€åŒ–ä»£ç ï¼‰
- Validationï¼ˆå‚æ•°æ ¡éªŒï¼‰
- PageHelper 1.4.3ï¼ˆåˆ†é¡µæ’ä»¶ï¼‰âš ï¸ æ³¨æ„ï¼šä¸ŽMyBatis Plusåˆ†é¡µæ’ä»¶å¯èƒ½å­˜åœ¨å†²çª
- Hutool 5.8.25ï¼ˆJavaå·¥å…·åº“ï¼ŒåŒ…å«JSONå¤„ç†ã€HTTPå®¢æˆ·ç«¯ã€åŠ å¯†ã€å­—ç¬¦ä¸²å¤„ç†ç­‰ï¼‰
- SpringDoc OpenAPI 1.7.0ï¼ˆAPIæ–‡æ¡£ç”Ÿæˆï¼Œæ”¯æŒSwagger UIï¼‰

## ç›®å½•ç»“æž„

```
.
â”œâ”€â”€ Dockerfile                      Dockerfile æ–‡ä»¶
â”œâ”€â”€ LICENSE                         LICENSE æ–‡ä»¶
â”œâ”€â”€ README.md                       README æ–‡ä»¶
â”œâ”€â”€ container.config.json           æ¨¡æ¿éƒ¨ç½²ã€ŒæœåŠ¡è®¾ç½®ã€åˆå§‹åŒ–é…ç½®
â”œâ”€â”€ mvnw                            mvnw æ–‡ä»¶ï¼Œå¤„ç†mavenç‰ˆæœ¬å…¼å®¹é—®é¢˜
â”œâ”€â”€ mvnw.cmd                        mvnw.cmd æ–‡ä»¶ï¼Œå¤„ç†mavenç‰ˆæœ¬å…¼å®¹é—®é¢˜
â”œâ”€â”€ pom.xml                         pom.xmlæ–‡ä»¶
â”œâ”€â”€ settings.xml                    maven é…ç½®æ–‡ä»¶
â”œâ”€â”€ docs/                           # æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ db.sql                      # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼ˆå®žé™…ä½ç½®ï¼‰
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java/com/tencent/wxcloudrun
    â”‚   â”‚   â”œâ”€â”€ WxCloudRunApplication.java       # å¯åŠ¨ç±»
    â”‚   â”‚   â”œâ”€â”€ config/                          # é…ç½®ç±»
    â”‚   â”‚   â”‚   â”œâ”€â”€ WxConfig.java               # å¾®ä¿¡å°ç¨‹åºé…ç½®
    â”‚   â”‚   â”‚   â”œâ”€â”€ WebConfig.java              # Webé…ç½®ï¼ˆæ‹¦æˆªå™¨ã€å‚æ•°è§£æžå™¨ï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ OpenApiConfig.java          # OpenAPI 3.0æ–‡æ¡£é…ç½®
    â”‚   â”‚   â”‚   â””â”€â”€ MyBatisPlusConfig.java      # MyBatis Plusåˆ†é¡µæ’ä»¶é…ç½®
    â”‚   â”‚   â”œâ”€â”€ context/                         # ä¸Šä¸‹æ–‡å­˜å‚¨
    â”‚   â”‚   â”‚   â””â”€â”€ TokenContext.java           # Tokenå†…å­˜å­˜å‚¨ï¼ˆTimedCacheï¼‰
    â”‚   â”‚   â”œâ”€â”€ interceptor/                     # æ‹¦æˆªå™¨ï¼ˆæ–°å¢žï¼‰
    â”‚   â”‚   â”‚   â””â”€â”€ AuthInterceptor.java        # ç»Ÿä¸€è®¤è¯æ‹¦æˆªå™¨
    â”‚   â”‚   â”œâ”€â”€ auth/                            # è®¤è¯ç›¸å…³ï¼ˆæ–°å¢žï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ LoginUser.java              # ç™»å½•ç”¨æˆ·ä¿¡æ¯å°è£…
    â”‚   â”‚   â”‚   â””â”€â”€ LoginUserArgumentResolver.java # è‡ªåŠ¨æ³¨å…¥ç™»å½•ç”¨æˆ·å‚æ•°
    â”‚   â”‚   â”œâ”€â”€ controller/                      # æŽ§åˆ¶å™¨å±‚
    â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.java         # è®¤è¯æŽ¥å£
    â”‚   â”‚   â”‚   â”œâ”€â”€ PlantController.java        # æ¤ç‰©ç®¡ç†æŽ¥å£
    â”‚   â”‚   â”‚   â”œâ”€â”€ RecordController.java       # ç§æ¤è®°å½•æŽ¥å£
    â”‚   â”‚   â”‚   â””â”€â”€ ReminderController.java     # æé†’ç®¡ç†æŽ¥å£
    â”‚   â”‚   â”œâ”€â”€ service/                         # æœåŠ¡å±‚æŽ¥å£
    â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ PlantService.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ RecordService.java
    â”‚   â”‚   â”‚   â””â”€â”€ ReminderService.java
    â”‚   â”‚   â”œâ”€â”€ service/impl/                    # æœåŠ¡å®žçŽ°
    â”‚   â”‚   â”‚   â”œâ”€â”€ AuthServiceImpl.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ PlantServiceImpl.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ RecordServiceImpl.java
    â”‚   â”‚   â”‚   â””â”€â”€ ReminderServiceImpl.java
    â”‚   â”‚   â”œâ”€â”€ dao/                             # æ•°æ®è®¿é—®å±‚ï¼ˆMyBatisæ³¨è§£æ–¹å¼ï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ PlantMapper.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ RecordMapper.java
    â”‚   â”‚   â”‚   â””â”€â”€ ReminderMapper.java
    â”‚   â”‚   â”œâ”€â”€ model/                           # å®žä½“ç±»
    â”‚   â”‚   â”‚   â”œâ”€â”€ User.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ Plant.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ Record.java
    â”‚   â”‚   â”‚   â””â”€â”€ Reminder.java
    â”‚   â”‚   â”œâ”€â”€ dto/                             # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”‚   â”‚   â”‚   â”œâ”€â”€ req/                         # è¯·æ±‚DTO
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PageQueryRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RecordPageQueryRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReminderPageQueryRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PlantRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RecordRequest.java
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReminderRequest.java
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CommonRequest.java      # é€šç”¨è¯·æ±‚å‚æ•°ï¼ˆæ–°å¢žï¼‰
    â”‚   â”‚   â”‚   â””â”€â”€ resp/                        # å“åº”DTO
    â”‚   â”‚   â”‚       â”œâ”€â”€ ApiResponse.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ LoginResponse.java
    â”‚   â”‚   â”‚       â”œâ”€â”€ ProfileResponse.java
    â”‚   â”‚   â”‚       â””â”€â”€ PageResponse.java
    â”‚   â”‚   â”œâ”€â”€ exception/                       # å¼‚å¸¸å¤„ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ BusinessException.java
    â”‚   â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java
    â”‚   â”‚   â”œâ”€â”€ constant/                        # æžšä¸¾å¸¸é‡ï¼ˆæ‰©å±•ï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ CodeEnum.java
    â”‚   â”‚   â”‚   â”œâ”€â”€ AuthConstant.java           # è®¤è¯å¸¸é‡å®šä¹‰
    â”‚   â”‚   â”‚   â””â”€â”€ YesOrNoEnum.java            # æ˜¯å¦æžšä¸¾ï¼ˆæ–°å¢žï¼‰
    â”‚   â””â”€â”€ resources                            # èµ„æºæ–‡ä»¶
    â”‚       â”œâ”€â”€ application.yml                   # åº”ç”¨é…ç½®
    â”‚       â”œâ”€â”€ application-dev.yml              # å¼€å‘çŽ¯å¢ƒé…ç½®
    â”‚       â”œâ”€â”€ application-prod.yml             # ç”Ÿäº§çŽ¯å¢ƒé…ç½®
    â”‚       â””â”€â”€ application-test.yml             # æµ‹è¯•çŽ¯å¢ƒé…ç½®
    â””â”€â”€ test                                     # æµ‹è¯•èµ„æº
        â””â”€â”€ resources/
            â”œâ”€â”€ application-test.yml             # æµ‹è¯•çŽ¯å¢ƒé…ç½®
            â””â”€â”€ test-data.sql                    # æµ‹è¯•æ•°æ®è„šæœ¬
```

## è®¤è¯æ¨¡å—

### ç™»å½•æµç¨‹

```
å°ç¨‹åºç«¯                          å¼€å‘è€…æœåŠ¡å™¨                    å¾®ä¿¡æŽ¥å£æœåŠ¡
  â”‚                                  â”‚                              â”‚
  â”‚â”€â”€ wx.login() èŽ·å– code          â”‚                              â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚
  â”‚                                  â”‚â”€â”€ code + appid + secret     â”‚
  â”‚                                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                  â”‚<â”€â”€ session_key + openid â”€â”€â”€â”€â”‚
  â”‚                                  â”‚                              â”‚
  â”‚                                  â”‚â”€â”€ ç”Ÿæˆè‡ªå®šä¹‰ç™»å½•æ€ (token)   â”‚
  â”‚                                  â”‚â”€â”€ è¿”å›ž token + userId       â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
```

### æŽ¥å£åˆ—è¡¨

#### ðŸ” è®¤è¯ç®¡ç†æ¨¡å— (Auth)
æ‰€æœ‰è®¤è¯æŽ¥å£éœ€è¦é…ç½®å¾®ä¿¡å°ç¨‹åºAppIDå’ŒAppSecretã€‚

| æŽ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜Ž | è®¤è¯è¦æ±‚ |
|-----|------|------|------|---------|
| å¾®ä¿¡ç™»å½• | POST | `/api/auth/login` | é€šè¿‡å¾®ä¿¡codeèŽ·å–ç”¨æˆ·openidå¹¶ç”Ÿæˆç™»å½•token | æ— éœ€è®¤è¯ |
| èŽ·å–ç”¨æˆ·èµ„æ–™ | POST | `/api/auth/getProfile` | èŽ·å–å½“å‰ç™»å½•ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯ | âœ… éœ€è¦Token |
| æ›´æ–°ç”¨æˆ·èµ„æ–™ | POST | `/api/auth/updateProfile` | æ›´æ–°ç”¨æˆ·æ˜µç§°å’Œå¤´åƒç­‰ä¿¡æ¯ | âœ… éœ€è¦Token |
| é€€å‡ºç™»å½• | POST | `/api/auth/logout` | æ¸…é™¤å½“å‰ç”¨æˆ·çš„ç™»å½•Token | âœ… éœ€è¦Token |

#### ðŸŒ± æ¤ç‰©ç®¡ç†æ¨¡å— (Plant)
æ‰€æœ‰æ¤ç‰©ç®¡ç†æŽ¥å£éœ€è¦Tokenè®¤è¯ï¼Œè‡ªåŠ¨å…³è”å½“å‰ç”¨æˆ·ã€‚

| æŽ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜Ž | è®¤è¯è¦æ±‚ |
|-----|------|------|------|---------|
| æ¤ç‰©åˆ†é¡µæŸ¥è¯¢ | POST | `/api/plants/page` | èŽ·å–ç”¨æˆ·çš„æ¤ç‰©åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… éœ€è¦Token |
| èŽ·å–æ¤ç‰©è¯¦æƒ… | POST | `/api/plants/getPlantById` | æ ¹æ®IDèŽ·å–æ¤ç‰©è¯¦ç»†ä¿¡æ¯ | âœ… éœ€è¦Token |
| åˆ›å»ºæ¤ç‰© | POST | `/api/plants/createPlant` | åˆ›å»ºæ–°çš„æ¤ç‰©è®°å½• | âœ… éœ€è¦Token |
| æ›´æ–°æ¤ç‰© | POST | `/api/plants/update` | æ›´æ–°æ¤ç‰©ä¿¡æ¯ | âœ… éœ€è¦Token |
| åˆ é™¤æ¤ç‰© | POST | `/api/plants/delete` | åˆ é™¤æŒ‡å®šæ¤ç‰© | âœ… éœ€è¦Token |

#### ðŸ“ ç”Ÿé•¿è®°å½•æ¨¡å— (Record)
ç”Ÿé•¿è®°å½•åŒ…æ‹¬æµ‡æ°´ã€æ–½è‚¥ã€ç”Ÿé•¿ã€æ‹ç…§ç­‰ç±»åž‹ã€‚

| æŽ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜Ž | è®¤è¯è¦æ±‚ |
|-----|------|------|------|---------|
| è®°å½•åˆ†é¡µæŸ¥è¯¢ | POST | `/api/records/page` | èŽ·å–ç”¨æˆ·çš„ç”Ÿé•¿è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… éœ€è¦Token |
| èŽ·å–è®°å½•è¯¦æƒ… | POST | `/api/records/getRecordById` | æ ¹æ®IDèŽ·å–è®°å½•è¯¦ç»†ä¿¡æ¯ | âœ… éœ€è¦Token |
| åˆ›å»ºè®°å½• | POST | `/api/records/createRecord` | åˆ›å»ºæ–°çš„ç”Ÿé•¿è®°å½• | âœ… éœ€è¦Token |
| æ›´æ–°è®°å½• | POST | `/api/records/update` | æ›´æ–°è®°å½•ä¿¡æ¯ | âœ… éœ€è¦Token |
| åˆ é™¤è®°å½• | POST | `/api/records/delete` | åˆ é™¤æŒ‡å®šè®°å½• | âœ… éœ€è¦Token |

#### â° æé†’ç®¡ç†æ¨¡å— (Reminder)
æé†’ç®¡ç†åŒ…æ‹¬æµ‡æ°´ã€æ–½è‚¥ã€è‡ªå®šä¹‰æé†’çš„è°ƒåº¦ã€‚

| æŽ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜Ž | è®¤è¯è¦æ±‚ |
|-----|------|------|------|---------|
| æé†’åˆ†é¡µæŸ¥è¯¢ | POST | `/api/reminders/page` | èŽ·å–ç”¨æˆ·çš„æé†’åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… éœ€è¦Token |
| èŽ·å–æé†’è¯¦æƒ… | POST | `/api/reminders/getReminderById` | æ ¹æ®IDèŽ·å–æé†’è¯¦ç»†ä¿¡æ¯ | âœ… éœ€è¦Token |
| åˆ›å»ºæé†’ | POST | `/api/reminders/createReminder` | åˆ›å»ºæ–°çš„å…»æŠ¤æé†’ | âœ… éœ€è¦Token |
| æ›´æ–°æé†’ | POST | `/api/reminders/update` | æ›´æ–°æé†’ä¿¡æ¯ | âœ… éœ€è¦Token |
| åˆ é™¤æé†’ | POST | `/api/reminders/delete` | åˆ é™¤æŒ‡å®šæé†’ | âœ… éœ€è¦Token |
| å¯ç”¨/ç¦ç”¨æé†’ | POST | `/api/reminders/isEnabled` | åˆ‡æ¢æé†’çš„å¯ç”¨çŠ¶æ€ | âœ… éœ€è¦Token |


### è¯·æ±‚ç¤ºä¾‹

**ç™»å½•**
```json
POST /api/auth/login
{
  "code": "å¾®ä¿¡wx.loginè¿”å›žçš„code"
}
```

**å“åº”**
```json
{
  "code": 0,
  "data": {
    "token": "è‡ªå®šä¹‰ç™»å½•æ€token",
    "isNewUser": true
  }
}
```

### Token è®¤è¯

åŽç»­è¯·æ±‚éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Tokenï¼š
```
X-Token: your_token_here
```

**è®¤è¯æ–¹å¼æ›´æ–°**ï¼š
- âœ… **ç»Ÿä¸€è®¤è¯æ‹¦æˆªå™¨**ï¼šå·²å®žçŽ° `AuthInterceptor` è‡ªåŠ¨éªŒè¯Tokenæœ‰æ•ˆæ€§
- âœ… **å‚æ•°è‡ªåŠ¨æ³¨å…¥**ï¼šæŽ§åˆ¶å™¨æ–¹æ³•å¯ä½¿ç”¨ `LoginUser` å‚æ•°è‡ªåŠ¨èŽ·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€æ‰‹åŠ¨éªŒè¯
- âœ… **è®¤è¯æ–¹å¼ç»Ÿä¸€**ï¼šæ‰€æœ‰æŽ¥å£ç»Ÿä¸€ä½¿ç”¨ `X-Token` è¯·æ±‚å¤´ï¼Œæ¶ˆé™¤å®‰å…¨é£Žé™©

### Token å­˜å‚¨æœºåˆ¶

- **å­˜å‚¨æ–¹å¼**ï¼šå†…å­˜å­˜å‚¨ï¼ˆHutool TimedCacheï¼‰ï¼Œé€‚åˆå•æœºéƒ¨ç½²
- **æœ‰æ•ˆæœŸ**ï¼š30å¤©ï¼ˆ30 * 24 * 60 * 60 * 1000æ¯«ç§’ï¼‰
- **æ•°æ®ç»“æž„**ï¼š
  - Tokenç¼“å­˜ï¼štoken â†’ TokenInfoï¼ˆopenid, userId, expireTimeï¼‰
  - OpenIDç¼“å­˜ï¼šopenid â†’ tokenï¼ˆç”¨äºŽå¿«é€ŸæŸ¥æ‰¾ï¼‰
- **æ”¹è¿›çŠ¶æ€**ï¼š
  1. âœ… **ç»Ÿä¸€è®¤è¯æ‹¦æˆªå™¨**ï¼šå·²å®žçŽ°ï¼Œæ¶ˆé™¤æŽ§åˆ¶å™¨æ–¹æ³•ä¸­çš„é‡å¤éªŒè¯ä»£ç 
  2. âœ… **å¾®ä¿¡API URLé”™è¯¯**ï¼šå·²ä¿®å¤ï¼Œä½¿ç”¨æ­£ç¡®çš„ `jscode2session` API
  3. âš ï¸ **å­—æ®µå‘½åä¼˜åŒ–**ï¼š`userId`å­—æ®µåå­˜å‚¨çš„æ˜¯openidå€¼ï¼Œå»ºè®®é‡å‘½åä¸º`openid`

## åˆ†é¡µæŸ¥è¯¢

æ‰€æœ‰åˆ—è¡¨æŸ¥è¯¢æŽ¥å£ç»Ÿä¸€ä½¿ç”¨ POST + è¯·æ±‚ä½“ï¼š

| æŽ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯·æ±‚DTO |
|-----|------|------|---------|
| æ¤ç‰©åˆ—è¡¨ | POST | `/api/plants/page` | PageQueryRequest |
| è®°å½•åˆ—è¡¨ | POST | `/api/records/page` | RecordPageQueryRequest |
| æé†’åˆ—è¡¨ | POST | `/api/reminders/page` | ReminderPageQueryRequest |

**æ¤ç‰©åˆ—è¡¨è¯·æ±‚ç¤ºä¾‹**
```json
POST /api/plants/page
{
  "pageNum": 1,
  "pageSize": 10,
  "userId": "ç”¨æˆ·openid"
}
```

**åˆ†é¡µå“åº”æ ¼å¼**
```json
{
  "code": 0,
  "data": {
    "list": [...],          // æ•°æ®åˆ—è¡¨
    "total": 100,           // æ€»è®°å½•æ•°
    "pageNum": 1,           // å½“å‰é¡µç 
    "pageSize": 10,         // æ¯é¡µå¤§å°
    "totalPages": 10        // æ€»é¡µæ•°
  }
}
```

### è®¤è¯æ–¹å¼æ›´æ–°çŠ¶æ€

**âœ… è®¤è¯æ–¹å¼å·²ç»Ÿä¸€è§£å†³**ï¼š
1. **ç»Ÿä¸€è®¤è¯æ‹¦æˆªå™¨**ï¼šå·²å®žçŽ° `AuthInterceptor` è‡ªåŠ¨éªŒè¯ `X-Token`
2. **å‚æ•°è‡ªåŠ¨æ³¨å…¥**ï¼šæŽ§åˆ¶å™¨æ–¹æ³•ä½¿ç”¨ `LoginUser` å‚æ•°è‡ªåŠ¨èŽ·å–ç”¨æˆ·ä¿¡æ¯
3. **å®‰å…¨æ”¹è¿›**ï¼šæ¶ˆé™¤ `X-User-ID` ç›´æŽ¥ä¼ é€’çš„å®‰å…¨é£Žé™©
4. **ä»£ç ç®€åŒ–**ï¼šæŽ§åˆ¶å™¨æ–¹æ³•ä¸å†éœ€è¦æ‰‹åŠ¨éªŒè¯Tokenï¼Œå‡å°‘é‡å¤ä»£ç 

## æœ¬åœ°è°ƒè¯•

ä¸‹è½½ä»£ç åœ¨æœ¬åœ°è°ƒè¯•ï¼Œè¯·å‚è€ƒ[å¾®ä¿¡äº‘æ‰˜ç®¡æœ¬åœ°è°ƒè¯•æŒ‡å—](https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/guide/debug/)ã€‚

## å®žæ—¶å¼€å‘

ä»£ç å˜åŠ¨æ—¶ï¼Œä¸éœ€è¦é‡æ–°æž„å»ºå’Œå¯åŠ¨å®¹å™¨ï¼Œå³å¯æŸ¥çœ‹å˜åŠ¨åŽçš„æ•ˆæžœã€‚è¯·å‚è€ƒ[å¾®ä¿¡äº‘æ‰˜ç®¡å®žæ—¶å¼€å‘æŒ‡å—](https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/guide/debug/dev.html)

## Dockerfileæœ€ä½³å®žè·µ

è¯·å‚è€ƒ[å¦‚ä½•æé«˜é¡¹ç›®æž„å»ºæ•ˆçŽ‡](https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/scene/build/speed.html)

## çŽ¯å¢ƒå˜é‡

éƒ¨ç½²æ—¶éœ€è¦åœ¨ã€ŒæœåŠ¡è®¾ç½®ã€ä¸­é…ç½®ä»¥ä¸‹çŽ¯å¢ƒå˜é‡ï¼š

- **æ•°æ®åº“é…ç½®**ï¼š
  - MYSQL_ADDRESS - MySQLåœ°å€ï¼ˆå¦‚ï¼šlocalhost:3306ï¼‰
  - MYSQL_USERNAME - MySQLç”¨æˆ·å
  - MYSQL_PASSWORD - MySQLå¯†ç 
  - MYSQL_DATABASE - æ•°æ®åº“åç§°ï¼ˆé»˜è®¤ä¸ºplant_helperï¼‰

- **åº”ç”¨é…ç½®**ï¼š
  - SPRING_PROFILES_ACTIVE - è¿è¡ŒçŽ¯å¢ƒï¼ˆdev/test/prodï¼‰

- **å¾®ä¿¡å°ç¨‹åºé…ç½®**ï¼š
  - WX_APPID - å¾®ä¿¡å°ç¨‹åºAppID
  - WX_SECRET - å¾®ä¿¡å°ç¨‹åºAppSecret

### æ•°æ®åº“è¯´æ˜Ž
é¡¹ç›®ä½¿ç”¨ä»¥ä¸‹æ•°æ®åº“è¡¨ï¼š
1. **users** - ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆopenid, nickname, avatar_urlï¼‰
2. **plants** - æ¤ç‰©ä¿¡æ¯è¡¨ï¼ˆåç§°ã€ç±»åž‹ã€çŠ¶æ€ã€æµ‡æ°´æ–½è‚¥é—´éš”ï¼‰
3. **records** - ç”Ÿé•¿è®°å½•è¡¨ï¼ˆæµ‡æ°´ã€æ–½è‚¥ã€ç”Ÿé•¿ã€æ‹ç…§è®°å½•ï¼‰
4. **reminders** - æé†’è¡¨ï¼ˆæµ‡æ°´ã€æ–½è‚¥ã€è‡ªå®šä¹‰æé†’ï¼‰

å®Œæ•´SQLè„šæœ¬è§ï¼š[docs/db.sql](./docs/db.sql)

## License

[MIT](./LICENSE)
